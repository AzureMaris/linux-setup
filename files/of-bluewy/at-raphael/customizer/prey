#!/usr/bin/env nu

use ./lib [ steam_env proton_env mangohud_config_values ]

def --wrapped main [...command]: nothing -> nothing {
   with-env {
      ...$steam_env
      ...$proton_env

      MANGOHUD_CONFIG: (
         $mangohud_config_values
         | where {|value| $value != fps_limit=0 }
         | append fps_limit=157
         | str join ','
      )
   } {
      exec (
         gamescope
         -W 1920
         -H 1080
         -w 2560
         -h 1440
         -r 120
         --force-grab-cursor
         --mangoapp
         -- game-performance ...$command
      )
   }
}
