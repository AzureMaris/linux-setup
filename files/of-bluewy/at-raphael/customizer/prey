#!/usr/bin/env nu

use ./lib/steam.nu steam_env
use ./lib/proton.nu proton_env
use ./lib/mangohud.nu [ mangohud_config_values setup-mangohud-config-file ]

const file_path = path self

def --wrapped main [
   ...rest: string
]: nothing -> nothing {
   let stem = $file_path | path parse | get stem

   with-env {
      ...$steam_env
      ...$proton_env
      ...(setup-mangohud-config-file $stem $mangohud_config_values)
   } {
      (
         exec
         gamescope
         -W 1920
         -H 1080
         -w 2560
         -h 1440
         -r 120
         --force-grab-cursor
         --mangoapp
         -- game-performance ...$rest
      )
   }
}
