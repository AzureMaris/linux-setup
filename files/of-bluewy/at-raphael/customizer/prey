#!/usr/bin/env nu

use ./lib [ steam_env proton_env get-mangohud-config-env get-gamescope-parameters-for-niri ]

def --wrapped main [...command]: nothing -> nothing {
   with-env {
      ...$steam_env
      ...$proton_env
      ...(get-mangohud-config-env)
      DXVK_FRAME_RATE: 144
   } {
      (
         exec
         (
            gamescope
            ...(get-gamescope-parameters-for-niri | flatten)
            -s 0.25
            --force-grab-cursor
            --mangoapp
            -- game-performance ...$command
         )
      )
   }
}
