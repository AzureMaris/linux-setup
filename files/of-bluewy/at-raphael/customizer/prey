#!/usr/bin/env nu

use ./lib [ steam_env proton_env get-mangohud-config-env get-gamescope-parameters-on-niri ]

def --wrapped main [...command]: nothing -> nothing {
   with-env {
      ...$steam_env
      ...$proton_env
      ...(get-mangohud-config-env)
   } {
      (
         exec
         (
            gamescope
            ...(
               get-gamescope-parameters-on-niri | where {|parameter|
                  $parameter.0 != r
               }
               | flatten
            )
            -r 144
            -s 0.25
            --force-grab-cursor
            --mangoapp
            -- game-performance ...$command
         )
      )
   }
}
