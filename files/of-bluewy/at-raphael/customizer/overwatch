#!/usr/bin/env nu

use ./lib/steam.nu steam_env
use ./lib/proton.nu proton_env
use ./lib/dxvk.nu setup-dxvk-config
use ./lib/mangohud.nu [ mangohud_config_values setup-mangohud-config ]

const file_path = path self

def --wrapped main [
...rest: string
]: nothing -> nothing {
   let stem = $file_path | path parse | get stem
   let mangohud_config = $mangohud_config_values | str join "\n"

   with-env {
      ...$steam_env
      ...$proton_env
      ...(setup-dxvk-config $stem 'dxvk.hud = compiler;')
      ...(setup-mangohud-config $stem $mangohud_config)
   } {
      exec mangohud game-performance ...$rest
   }
}
